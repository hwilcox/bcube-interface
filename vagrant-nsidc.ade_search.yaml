project: ade_search
gitrepo: git@bitbucket.org:nsidc/search-interface.git

vsphere:
  template: trusty64-nsidc

virtualbox:
  box: trusty64-nsidc
  box_url: http://snowhut.apps.int.nsidc.org/shares/export/sw/packages/vagrant/boxes/trusty64-nsidc.box

puppet:
  enabled: true
  execution_dir: /vagrant
  apply:
    options: --debug --verbose --modulepath=./puppet/modules --hiera_config=./puppet/hiera.ade_search.yaml
    manifest: ./puppet/site.pp
  librarian:
    puppetfile: ./puppet/Puppetfile

provision: |
  # set up environment to use correct vagrant-nsidc config
  export VAGRANT_NSIDC_YAML=vagrant-nsidc.%{hiera('project')}.yaml
  export NSIDC_PLUGIN_LOG=debug

  # compile jade and sass, minify js into build/
  grunt build:%{hiera('project')} --environment=$ENV

  # provision, including rsyncing build/ to /vagrant
  vagrant nsidc hijack --env=$ENV --project=%{hiera('project')} || true
  vagrant nsidc up --env=$ENV --provision --project=%{hiera('project')};

  # deploy app from /vagrant/build to /opt/%{hiera('project')}
  grunt deploy --environment=$ENV --project=%{hiera('project')}

  # update deployment tag
  grunt updateTag --environment=$ENV --project=%{hiera('project')}
